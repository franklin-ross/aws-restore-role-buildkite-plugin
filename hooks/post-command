#!/bin/bash

set -o pipefail

# Revert the AWS environment variables to the original values when this plugin
# ran before the command.

if [[ -n $UNASSUME_ROLE_PLUGIN_OG_AWS_ACCESS_KEY_ID ]]; then
  export AWS_ACCESS_KEY_ID="${UNASSUME_ROLE_PLUGIN_AWS_ACCESS_KEY_ID}"
  unset UNASSUME_ROLE_PLUGIN_OG_AWS_ACCESS_KEY_ID
else
  unset AWS_ACCESS_KEY_ID
fi
if [[ -n $UNASSUME_ROLE_PLUGIN_OG_AWS_SECRET_ACCESS_KEY ]]; then
  export AWS_SECRET_ACCESS_KEY="${UNASSUME_ROLE_PLUGIN_OG_AWS_SECRET_ACCESS_KEY}"
  unset UNASSUME_ROLE_PLUGIN_OG_AWS_SECRET_ACCESS_KEY
else
  unset AWS_SECRET_ACCESS_KEY
fi
if [[ -n $UNASSUME_ROLE_PLUGIN_OG_AWS_SESSION_TOKEN ]]; then
  export AWS_SESSION_TOKEN="${UNASSUME_ROLE_PLUGIN_OG_AWS_SESSION_TOKEN}"
  unset UNASSUME_ROLE_PLUGIN_OG_AWS_SESSION_TOKEN
else
  unset AWS_SESSION_TOKEN
fi
if [[ -n $UNASSUME_ROLE_PLUGIN_OG_AWS_REGION ]]; then
  export AWS_REGION="${UNASSUME_ROLE_PLUGIN_OG_AWS_REGION}"
  unset UNASSUME_ROLE_PLUGIN_OG_AWS_REGION
else
  unset AWS_REGION
fi
if [[ -n $UNASSUME_ROLE_PLUGIN_OG_AWS_DEFAULT_REGION ]]; then
  export AWS_DEFAULT_REGION="${UNASSUME_ROLE_PLUGIN_OG_AWS_DEFAULT_REGION}"
  unset UNASSUME_ROLE_PLUGIN_OG_AWS_DEFAULT_REGION
else
  unset AWS_DEFAULT_REGION
fi
